<!-- TMPL_INCLUDE NAME="doc-head-open.inc" -->
<title>Koha &rsaquo; Checkin</title>
<!-- TMPL_INCLUDE NAME="doc-head-close.inc" -->
<style type="text/css">
    background-color: red;
</style>
<script type="text/javascript">
//<![CDATA[

var closeGB = '<!-- TMPL_VAR NAME="closeGB" -->';
if (closeGB=='1') { // confirmed filled from Holds Queue
   parent.parent.document.location.href = '/cgi-bin/koha/circ/view_holdsqueue.pl'
   + '?branchlimit=<!-- TMPL_VAR NAME="queue_branchlimit" -->'
   + '&run_report=1&filled=1'
   + '&currPage=<TMPL_VAR NAME="queue_currPage">'
   + '&limit=<TMPL_VAR NAME="queue_limit">'
   + '&orderby=<TMPL_VAR NAME="queue_orderby">';
   parent.parent.GB_hide();
}

function Dopop(link) {
    var newin = window.open(
        link,'popup','width=600,height=400,resizable=1,toolbar=0,scrollbars=1,top');
}

$(document).ready( function() {
    [
        ['#exemptcheck', '#exemptfines' ],
        ['#dropboxcheck', '#dropboxmode']
    ].map( function(elem) {
        $(elem[0]).change( function() {
            if (this.checked) {
                $("#barcode").addClass("alert");
                $(elem[1]).show();
            } else {
                $("#barcode").removeClass("alert");
                $(elem[1]).hide();
            }
            $("#barcode").focus();
        })
    });

<!-- TMPL_IF NAME="overduecharges" -->
    $("#barcode").focus( function(){
        if(   $("#exemptcheck").attr("checked")
           || $("#dropboxcheck").attr("checked") )
        {
            $("#barcode").addClass("alert");
        } else {
            $("#barcode").removeClass("alert");
        }
    });

    $("#barcode").blur( function() {
        $("#barcode").removeClass("alert");
    });
<!-- /TMPL_IF -->

    $("#barcode").focus();
});

//]]>
function clearBackdate() {
   $('#f_checkin_override_date').val('');
   document.myf.submit();
}
</script>

<script type="text/javascript">
function HaltReturns() {
	$('#barcode').attr("disabled", true);
	$('#barcode_submit').attr("disabled", true);
}
</script>

<!-- TMPL_INCLUDE NAME="calendar.inc" -->
</head>
<body>
<!-- TMPL_INCLUDE NAME="header.inc" -->
<!-- TMPL_INCLUDE NAME="checkin-search.inc" -->

<div id="breadcrumbs"><a href="/cgi-bin/koha/mainpage.pl">Home</a> &rsaquo; <a href="/cgi-bin/koha/circ/circulation-home.pl">Circulation</a> &rsaquo; Check In</div>

<div id="doc" class="yui-t7">
   
   <div id="bd">
	<div id="yui-main">

<div class="yui-g">
<!-- error messages go before any form -->
<!-- TMPL_IF NAME="errmsgloop" -->
    <div class="dialog message" id="errmsg">
        <!-- TMPL_LOOP NAME="errmsgloop" -->
                    <!-- TMPL_IF Name="badbarcode" -->
                        <p class="problem">No Item with barcode: <!-- TMPL_VAR Name="msg" -->
					<!-- TMPL_IF NAME="UseReceiptTemplates_NotFound" -->
				                <input type="submit" value="Print Receipt" class="print" onclick="Dopop('/cgi-bin/koha/tools/receipt_generation.pl?action=not_found&amp;barcode=<!-- TMPL_VAR Name="msg" -->');" />
					<!-- /TMPL_IF -->
			</p>
                    <!-- /TMPL_IF -->
                    <!-- TMPL_IF Name="ispermanent" -->
                        <p class="problem">Permanent Collection: Please return to  <!-- TMPL_VAR Name="msg" --></p>
                    <!-- /TMPL_IF -->
                    <!-- TMPL_IF Name="notissued" -->
                        <p class="problem">Not checked out.</p>
                    <!-- /TMPL_IF -->
                    <TMPL_IF NAME="returndateLTissuedate">
                        <p class="problem"><TMPL_VAR NAME="msg"></p>
                    </TMPL_IF>
                    <!-- TMPL_IF NAME="waslost" -->
			            <script type="text/javascript">$(document).ready(function() {HaltReturns();});</script>
                        <p class="problem"><font style="color:red"><h3>Item was lost, now found.</h3></font></p>
                        <TMPL_IF NAME="lostborrowernumber">
                           Linked as lost to <a href="/cgi-bin/koha/circ/circulation.pl?borrowernumber=<TMPL_VAR NAME="lostborrowernumber">"><TMPL_VAR NAME="lostbor_firstname"> 
                              <TMPL_VAR NAME="lostbor_surname"></a>'s 
                             (<TMPL_VAR NAME="lostbor_cardnumber">) account<br>
                           <form action="returns.pl" method="post" name="lostf">
                              <TMPL_LOOP NAME="inputloop">
                              <input type="hidden" name="od-<!-- TMPL_VAR NAME="counter" -->" value="<!-- TMPL_VAR NAME="overdue" -->" />
                              <input type="hidden" name="ri-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="barcode" -->" />
                              <input type="hidden" name="dd-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="duedate" -->" />
                              <input type="hidden" name="bn-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="borrowernumber" -->" />
                              </TMPL_LOOP>
                              <input type=hidden name="unlinkFromAccount" value="1">
                              <input type=hidden name="lostbarcode" value="<!-- TMPL_VAR Name="itembarcode" -->" />
                              <input type=hidden name="lost_item_id"   value="<TMPL_VAR NAME="lost_item_id">">
                              <input type=hidden name="itemnumber"     value="<TMPL_VAR NAME="itemnumber">">
                              <input type=hidden name="borrowernumber" value="<TMPL_VAR NAME="borrowernumber">">
                              <input type="hidden" name="exemptfine" value="<TMPL_VAR NAME="exemptfine">"/>
                              <input type="hidden" name="dropboxmode" value="<TMPL_VAR NAME="dropboxmode">"/>
                              <input type="hidden" name="checkin_override_date" value="<TMPL_VAR NAME="checkin_override_date">"/>
                              <input type="button" value="Remove from patron's Lost Items" onclick="
                                if (document.foundf || document.transferf || document.alreadytransf || document.holdtransf || document.transwaitf || document.mainform) {
                                    var f;
                                    if (document.transferf)          { f = document.transferf     }
                                    else if (document.alreadytransf) { f = document.alreadytransf }
                                    else if (document.foundf)        { f = document.foundf        }
                                    else if (document.transwaitf)    { f = document.transwaitf    }
                                    else if (document.mainform)      { f = document.mainform      }
                                    else                             { f = document.holdtransf    }
                                    f.lost_item_id.value       = '<TMPL_VAR NAME="lost_item_id">';
                                    f.lostbarcode.value        = '<TMPL_VAR NAME="itembarcode">';
                                    f.lostborrowernumber.value = '<TMPL_VAR NAME="lostborrowernumber">';
                                    f.unlinkFromAccount.value  = 1;
                                    $('#errmsg').hide('slow'); 
                                    return false;
                                }
                                else {
                                    document.lostf.submit();
                                }
                              " />
					          <TMPL_IF NAME="UseReceiptTemplates_ClaimsReturnedFound">
				              <input type="submit" value="Print Receipt" class="print" onclick="Dopop('/cgi-bin/koha/tools/receipt_generation.pl?action=claims_returned_found&amp;barcode=<!-- TMPL_VAR Name="itembarcode" -->');" />
					          </TMPL_IF>
                           </form>
                        <TMPL_ELSE>
                        <form method=post action="returns.pl" name="simplelostf">
                        <TMPL_LOOP NAME="inputloop">
                        <input type="hidden" name="od-<!-- TMPL_VAR NAME="counter" -->" value="<!-- TMPL_VAR NAME="overdue" -->" />
                        <input type="hidden" name="ri-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="barcode" -->" />
                        <input type="hidden" name="dd-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="duedate" -->" />
                        <input type="hidden" name="bn-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="borrowernumber" -->" />
                        </TMPL_LOOP>
			               <p><input type=button value="Continue" onclick="
                           if (document.transferf
                            || document.holdtransf 
                            || document.foundf 
                            || document.transwaitf
                            || document.alreadytransf
                            || document.mainform) {
                             $('#errmsg').hide('slow');
                              return false;
                           }
                           else {
                              //submit, show mainform
                              this.form.submit();
                           }
                        "></p>
                        </form>
                        </TMPL_IF><!-- lostborrowernumber -->
                     </TMPL_IF><!-- waslost -->
                    <!-- TMPL_IF Name="withdrawn" -->
                        <p class="problem">Item is withdrawn.</p>
                    <!-- /TMPL_IF -->
                    <TMPL_IF NAME="res_reservenumber">
                        <TMPL_UNLESS NAME="found">
                        Hold found expected at <b><TMPL_VAR NAME="pickbranchname"></b>
                        </TMPL_UNLESS>
                    </TMPL_IF>
            <!-- /TMPL_LOOP -->
            <!-- TMPL_IF NAME="soundon" -->
                <audio src="/intranet-tmpl/prog/sound/critical.ogg" autoplay="autoplay" autobuffer="autobuffer"></audio>
            <!-- /TMPL_IF -->
            <!-- TMPL_ELSE -->
            <!-- TMPL_IF NAME="soundon" -->
                <audio src="/intranet-tmpl/prog/sound/beep.ogg" autoplay="autoplay" autobuffer="autobuffer"></audio>
            <!-- /TMPL_IF -->
        <!-- /TMPL_IF -->
    </div>
<!-- /TMPL_IF -->


<!-- TMPL_IF EXPR="wrongbranch and not(needstransfer) and not(WrongTransfer)" -->
<div class="dialog alert"><h3>Cannot Check In</h3><p>This item must be checked in at receiving library (<!-- TMPL_VAR NAME="rightbranch" -->). <strong>NOT CHECKED IN</strong></p>
</div>
<!-- /TMPL_IF -->

<!-- case of a mistake in transfer loop -->
<TMPL_IF NAME="WrongTransfer">
    <div class="dialog message">
    <p class="error">Already scheduled to be in transit
    <TMPL_IF NAME="TransferWaitingAtBranchname">to <TMPL_VAR NAME="TransferWaitingAtBranchname"> (<!-- TMPL_VAR NAME="TransferWaitingAtBranchcode" -->)
    <TMPL_ELSE><!-- do nothing here -->
    </TMPL_IF>
    </p>
    <TMPL_UNLESS NAME="reserved">
        <h3>Please send <a href="/cgi-bin/koha/catalogue/detail.pl?type=intra&amp;biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->"><!-- TMPL_VAR Name="title" escape="html" --></a> to 
        <TMPL_IF NAME="wborcnum"><br><TMPL_VAR NAME="wpickbranchname"> (<!-- TMPL_VAR NAME="wpickbranch" -->)</h3>
        <TMPL_ELSE><br><TMPL_VAR NAME="TransferWaitingAtBranchname"> (<!-- TMPL_VAR NAME="TransferWaitingAtBranchcode" -->)</h3>
            <form method=post action="returns.pl" name="alreadytransf">
            <input type=hidden name="cancelTransfer" value="0">
            <input type=hidden name="lost_item_id"       value="">
            <input type=hidden name="lostbarcode"        value="">
            <input type=hidden name="lostborrowernumber" value="">
            <input type=hidden name="unlinkFromAccount"  value="0">
            <input type=hidden name="itemnumber"     value="<TMPL_VAR NAME="itemnumber">">
            <input type="hidden" name="exemptfine" value="<TMPL_VAR NAME="exemptfine">"/>
            <input type="hidden" name="dropboxmode" value="<TMPL_VAR NAME="dropboxmode">"/>
            <input type="hidden" name="checkin_override_date" value="<TMPL_VAR NAME="checkin_override_date">"/>
            <TMPL_LOOP NAME="inputloop">
            <input type="hidden" name="od-<!-- TMPL_VAR NAME="counter" -->" value="<!-- TMPL_VAR NAME="overdue" -->" />
            <input type="hidden" name="ri-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="barcode" -->" />
            <input type="hidden" name="dd-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="duedate" -->" />
            <input type="hidden" name="bn-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="borrowernumber" -->" />
            </TMPL_LOOP>
            <input type=submit value="OK" class=approve>
            <input type=button value="Cancel transfer, Keep here" class=deny onclick="
                document.alreadytransf.cancelTransfer.value = 1;
                this.form.submit();
            " />
            </form>
        </TMPL_IF>
        <!-- TMPL_IF Name="wborcnum" --><h5>Hold pickup there for:</h5> 
        <ul>
            <li><a href="/cgi-bin/koha/members/moremember.pl?borrowernumber=<!-- TMPL_VAR NAME="borrowernumber" -->">
            <!-- TMPL_VAR Name="borsurname" -->, <!-- TMPL_VAR Name="borfirstname" --></a> (<!-- TMPL_VAR Name="borcnum" -->)</li>
            <li><!-- TMPL_VAR Name="wboraddress" --><!-- TMPL_IF NAME="wboraddress2" --><br />
		        <!-- TMPL_VAR NAME="wboraddress2" --><br /><!-- /TMPL_IF -->
                <!-- TMPL_VAR Name="wborcity" -->  <!-- TMPL_VAR NAME="wborzip" --></li>
                <!-- TMPL_IF NAME="wborphone" --><li><!-- TMPL_VAR Name="wborphone" --></li><!-- /TMPL_IF -->
		        <!-- TMPL_IF NAME="wboremail" --><li><a id="boremail" href="mailto:<!-- TMPL_VAR NAME="wboremail" -->"><!-- TMPL_VAR NAME="wboremail" --></a></li><!-- /TMPL_IF -->
        </ul> 
        <form method="post" action="returns.pl" name="holdtransf">
            <input type=hidden name="resbarcode" value="<TMPL_VAR NAME="barcode">">
            <input type=hidden name="dotransfer" value="1">
            <input type=hidden name="transferitem" value="<TMPL_VAR NAME="WrongTransferItem">">
            <input type=hidden name="tobranch" value="<TMPL_VAR NAME="wpickbranch">">
            <input type="hidden" name="fromqueue" value="<!-- TMPL_VAR NAME="fromqueue" -->">
            <input type=hidden name="queue_branchlimit" value="<!-- TMPL_VAR NAME="queue_branchlimit" -->">
            <input type=hidden name="queue_currPage" value="<TMPL_VAR NAME="queue_currPage">">
            <input type=hidden name="queue_limit"    value="<TMPL_VAR NAME="queue_limit">">
            <input type=hidden name="queue_orderby"  value="<TMPL_VAR NAME="queue_orderby">">
            <input type=hidden name="lost_item_id"   value="">
            <input type=hidden name="lostbarcode"    value="">
            <input type=hidden name="lostborrowernumber" value="">
            <input type=hidden name="unlinkFromAccount" value="1">
            <TMPL_LOOP NAME="inputloop">
            <input type="hidden" name="od-<!-- TMPL_VAR NAME="counter" -->" value="<!-- TMPL_VAR NAME="overdue" -->" />
            <input type="hidden" name="ri-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="barcode" -->" />
            <input type="hidden" name="dd-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="duedate" -->" />
            <input type="hidden" name="bn-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="borrowernumber" -->" />
            </TMPL_LOOP>

		    <!-- TMPL_IF name="HoldButtonConfirm" -->
            <input type="submit" class="approve" value="Confirm hold and <TMPL_IF EXPR="reroute">reroute </TMPL_IF>Transfer" />
            <!-- /TMPL_IF -->
		    <!-- TMPL_IF name="HoldButtonPrintConfirm" -->
			    <!-- TMPL_IF NAME="UseReceiptTemplates" -->
				    <!-- TMPL_IF NAME="UseReceiptTemplates_HoldFound" -->
			        <input type="submit" value="Print Slip and Confirm" class="print" onclick="Dopop('/cgi-bin/koha/tools/receipt_generation.pl?action=hold_found&amp;reservenumber=<!-- TMPL_VAR NAME="reservenumber" -->&amp;borrowernumber=<!-- TMPL_VAR NAME="borrowernumber" -->&amp;biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->'); this.form.submit();" />
				    <!-- /TMPL_IF -->
			    <!-- TMPL_ELSE -->
			    <input type="submit" value="Print Slip and Confirm" class="print" onclick="Dopop('hold-transfer-slip.pl?transfer=1&amp;reservenumber=<!-- TMPL_VAR NAME="reservenumber" -->&amp;borrowernumber=<!-- TMPL_VAR NAME="borrowernumber" -->&amp;biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->&amp;op=slip'); this.form.submit();" />
			    <!-- /TMPL_IF -->
        	<!-- /TMPL_IF -->
        </form>
        </TMPL_UNLESS>
        <TMPL_ELSE><!-- no holds pending? -->
            <TMPL_UNLESS NAME="reserved">
            <form method=post action="returns.pl" name="intransitf">
            <input type=hidden name="cancelTransfer" value="0">
            <input type=hidden name="itemnumber" value="<TMPL_VAR NAME="itemnumber">">
                <TMPL_LOOP NAME="inputloop">
                <input type="hidden" name="od-<!-- TMPL_VAR NAME="counter" -->" value="<!-- TMPL_VAR NAME="overdue" -->" />
                <input type="hidden" name="ri-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="barcode" -->" />
                <input type="hidden" name="dd-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="duedate" -->" />
                <input type="hidden" name="bn-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="borrowernumber" -->" />
                </TMPL_LOOP>
            <input type=submit value="Confirm transfer" class="approve">
            <input type=button value="Cancel transfer and Keep here" class="deny" onclick="
                document.intransitf.cancelTransfer.value=1;
                this.form.submit();
            " />
            </form>
            </TMPL_UNLESS>
    <!-- /TMPL_IF --></div>
<!-- /TMPL_IF -->

<!-- TMPL_IF Name="found" -->
    <!-- case of a reservation found, and display info -->
    <!-- TMPL_IF EXPR="waiting and not reroute" -->
        <!-- TMPL_IF NAME="soundon" -->
        <audio src="/intranet-tmpl/prog/sound/ending.ogg" autoplay="autoplay" autobuffer="autobuffer"></audio>
        <!-- /TMPL_IF -->      

        <div class="dialog message">
        <form method="post" action="returns.pl" class="confirm" name="foundf">
        <input type=hidden name="lost_item_id" value="">
        <input type=hidden name="lostbarcode"  value="">
        <input type=hidden name="lostborrowernumber" value="">
        <input type=hidden name="unlinkFromAccount" value="0">
        <h3>Hold Found
            <TMPL_IF NAME="pull">(please pull)
            <TMPL_ELSIF EXPR="waiting">(item is already waiting)
            <TMPL_ELSE>ERROR: uncaught exception
            </TMPL_IF>:<br><a href="/cgi-bin/koha/catalogue/detail.pl?biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->"><!-- TMPL_VAR Name="title" escape="html" --></a></h3>
        <!-- TMPL_IF NAME="reservenotes" --><h4>Notes: <!-- TMPL_VAR Name="reservenotes" --></h4><!-- /TMPL_IF -->
        <br><h4>Hold for:</h4>
			<ul>
            <li><a href="/cgi-bin/koha/members/moremember.pl?borrowernumber=<!-- TMPL_VAR NAME="borrowernumber" -->"><!-- TMPL_VAR Name="borsurname" -->, <!-- TMPL_VAR Name="borfirstname" --></a> (<!-- TMPL_VAR Name="borcnum" -->)</li>
            <li><!-- TMPL_VAR Name="boraddress" --><br />
			<!-- TMPL_IF NAME="boraddress2" --><!-- TMPL_VAR NAME="boraddress2" --><br /><!-- /TMPL_IF -->
            <!-- TMPL_VAR Name="borcity" --> <!-- TMPL_VAR NAME="borzip" --></li>
            <!-- TMPL_IF NAME="borphone" --><li> <!-- TMPL_VAR Name="borphone" --></li><!-- /TMPL_IF -->
		    <!-- TMPL_IF NAME="boremail" --><li><a id="boremail" href="mailto:<!-- TMPL_VAR NAME="boremail" -->"><!-- TMPL_VAR NAME="boremail" --></a></li><!-- /TMPL_IF -->
            <!-- TMPL_IF NAME="debarred" --><li class="error">Patron is RESTRICTED</li><!-- /TMPL_IF -->
            <!-- TMPL_IF NAME="gonenoaddress" --><li class="error">Patron's address is in doubt</li><!-- /TMPL_IF --></ul>
		    <!-- TMPL_IF name="transfertodo" -->
            <h4><strong>Transfer to:</strong> <!-- TMPL_VAR Name="destbranchname" --> (<!-- TMPL_VAR Name="destbranchcode" -->)</h4>
		    <!-- TMPL_ELSE -->
		        <h4><strong>Hold at</strong> <!-- TMPL_VAR Name="destbranchname" --></h4>
            <!-- /TMPL_IF -->
		    <!-- TMPL_IF name="HoldButtonConfirm" -->
                <input type="submit" class="approve" value="Confirm" />
        	<!-- /TMPL_IF -->
		    <!-- TMPL_IF name="HoldButtonPrintConfirm" -->
			    <!-- TMPL_IF NAME="UseReceiptTemplates" -->
				    <!-- TMPL_IF NAME="UseReceiptTemplates_HoldFound" -->
			            <input type="submit" value="Print Slip and Confirm" class="print" onclick="Dopop('/cgi-bin/koha/tools/receipt_generation.pl?action=hold_found&amp;reservenumber=<!-- TMPL_VAR NAME="reservenumber" -->&amp;borrowernumber=<!-- TMPL_VAR NAME="borrowernumber" -->&amp;biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->'); this.form.submit();" />
				    <!-- /TMPL_IF -->
			    <!-- TMPL_ELSE -->
				    <input type="submit" value="Print and Confirm" class="print" onclick="Dopop('hold-transfer-slip.pl?borrowernumber=<!-- TMPL_VAR NAME="borrowernumber" -->&amp;reservenumber=<!-- TMPL_VAR NAME="reservenumber" -->&amp;biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->&amp;op=slip'); this.form.submit();" />
			    <!-- /TMPL_IF -->
                <!-- TMPL_LOOP Name="inputloop" -->
                <input type="hidden" name="od-<!-- TMPL_VAR NAME="counter" -->" value="<!-- TMPL_VAR NAME="overdue" -->" />
                <input type="hidden" name="ri-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="barcode" -->" />
                <input type="hidden" name="dd-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="duedate" -->" />
                <input type="hidden" name="bn-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="borrowernumber" -->" />
                <!-- /TMPL_LOOP -->
                <input type="hidden" name="reservenumber" value="<!-- TMPL_VAR Name="reservenumber" -->" />
                <input type="hidden" name="itemnumber" value="<!-- TMPL_VAR Name="itemnumber" -->" />
                <input type="hidden" name="borrowernumber" value="<!-- TMPL_VAR Name="borrowernumber" -->" />
                <input type="hidden" name="resbarcode" value="<!-- TMPL_VAR Name="barcode" -->" />
                <input type="hidden" name="diffBranch" value="<!-- TMPL_VAR Name="destbranch" -->" />
                <input type="hidden" name="exemptfine" value="<!-- TMPL_VAR Name="exemptfine" -->" />
                <input type="hidden" name="dropboxmode" value="<!-- TMPL_VAR Name="dropboxmode" -->" />
                <input type="hidden" name="checkin_override_date" value="<TMPL_VAR NAME="checkin_override_date">"/>
                <input type=hidden name="fromqueue" value="<!-- TMPL_VAR NAME="fromqueue" -->">
                <input type=hidden name="queue_branchlimit" value="<!-- TMPL_VAR NAME="queue_branchlimit" -->">
                <input type=hidden name="queue_currPage" value="<TMPL_VAR NAME="queue_currPage">">
                <input type=hidden name="queue_limit"    value="<TMPL_VAR NAME="queue_limit">">
                <input type=hidden name="queue_orderby"  value="<TMPL_VAR NAME="queue_orderby">">
        	<!-- /TMPL_IF --><!-- holdbuttonprintconfirm -->
                </form>
	        </div>
        <TMPL_ELSE>
            <TMPL_IF EXPR="currentbranch ne destbranchname and (foundwait or pull) and not WrongTransfer">
            <div class="dialog message">
            <span class="error">Unexpected check in.</span>
            <h3>Hold found marked as <span class=error>
               <TMPL_IF EXPR="res_found eq 'W'">Waiting
               <TMPL_ELSIF EXPR="res_found eq 'T'">In Transit
               <TMPL_ELSE>ERROR: Uncaught exception
               </TMPL_IF></span>:</h3>
            <h4><a href="/cgi-bin/koha/detail.pl?biblionumber=<TMPL_VAR NAME="biblionumber">"><TMPL_VAR NAME="title"></a><br>
            at <TMPL_VAR NAME="pickbranchname"> for</h4>
            <ul>
                <li><a href="/cgi-bin/koha/circ/circulation.pl?borrowernumber=<TMPL_VAR NAME="borrowernumber">&opentab_holds=1#onhold"><TMPL_VAR NAME="name"></a>
                    (<TMPL_VAR NAME="borcnum">)</li>
                <li><TMPL_VAR NAME="boraddress"><TMPL_IF NAME="boraddress2"><br><TMPL_VAR NAME="boraddress2"></TMPL_IF><br>
                    <TMPL_VAR NAME="borcity"> <TMPL_VAR NAME="borzip"></li>
            </ul><br>
            <form method=post action="returns.pl" name="transwaitf">
            <input type=hidden name="dotransfer"    value="1">
            <input type=hidden name="requeue"       value="0">
            <input type=hidden name="reservenumber" value="<TMPL_VAR NAME="reservenumber">">
            <input type=hidden name="biblionumber"  value="<TMPL_VAR NAME="biblionumber">">
            <input type=hidden name="transferitem"  value="<TMPL_VAR NAME="itemnumber">">
            <input type=hidden name="itemnumber"    value="<TMPL_VAR NAME="itemnumber">">
            <input type=hidden name="resbarcode"    value="<TMPL_VAR NAME="barcode">">
            <input type=hidden name="tobranch"      value="<TMPL_VAR NAME="destbranch">">
            <input type=hidden name="diffBranch"    value="<TMPL_VAR NAME="destbranch">">
            <input type=hidden name="pickbranch"    value="<TMPL_VAR NAME="destbranch">">
            <input type=hidden name="exemptfine"    value="<TMPL_VAR NAME="exemptfine">">
            <input type=hidden name="dropboxmode"   value="<TMPL_VAR NAME="dropboxmode">">
            <input type=hidden name="lost_item_id"  value="">
            <input type=hidden name="lostbarcode"   value="">
            <input type=hidden name="lostborrowernumber" value="">
            <input type=hidden name="unlinkFromAccount" value="">
            <!-- TMPL_LOOP Name="inputloop" -->
            <input type="hidden" name="od-<!-- TMPL_VAR NAME="counter" -->" value="<!-- TMPL_VAR NAME="overdue" -->" />
            <input type="hidden" name="ri-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="barcode" -->" />
            <input type="hidden" name="dd-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="duedate" -->" />
            <input type="hidden" name="bn-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="borrowernumber" -->" />
            <!-- /TMPL_LOOP -->
            <input type=button value="Confirm and transfer" class="approve" onclick="this.form.submit();">
            <input type=button value="Ignore, Requeue hold and Keep Here" class="deny" onclick="
                document.transwaitf.requeue.value    = 1;
                document.transwaitf.dotransfer.value = 0;
                this.form.submit();
            ">
            </form>
            </div>
            </TMPL_IF>
        <!-- /TMPL_IF --><!-- waiting -->
        <!-- TMPL_IF NAME="diffbranch" -->
        <div class="dialog message">
        <form method="post" action="returns.pl" class="confirm" name="foundf">
        <input type=hidden name="lost_item_id" value="">
        <input type=hidden name="lostbarcode"  value="">
        <input type=hidden name="lostborrowernumber" value="">
        <input type=hidden name="unlinkFromAccount" value="0">

		<h3>Hold needing transfer found: <a href="/cgi-bin/koha/catalogue/detail.pl?biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->"><!-- TMPL_VAR Name="title" escape="html" --></a></h3>
                <h4>Hold for: </h4>
                    <ul>
                        <li><a href="/cgi-bin/koha/members/moremember.pl?borrowernumber=<!-- TMPL_VAR NAME="borrowernumber" -->"><!-- TMPL_VAR Name="borsurname" -->, <!-- TMPL_VAR Name="borfirstname" --></a> (<!-- TMPL_VAR Name="borcnum" -->)</li>
                        <li><!-- TMPL_VAR Name="boraddress" --><br />
						<!-- TMPL_IF NAME="boraddress2" --><!-- TMPL_VAR NAME="boraddress2" --><br /><!-- /TMPL_IF -->
						<!-- TMPL_VAR Name="borcity" -->  <!-- TMPL_VAR NAME="borzip" --></li>
                        <!-- TMPL_IF NAME="borphone" --><li><!-- TMPL_VAR Name="borphone" --></li><!-- /TMPL_IF -->
                        <!-- TMPL_IF NAME="boremail" --><li><!-- TMPL_IF name="transfertodo" --><!-- TMPL_VAR NAME="boremail" --><!-- TMPL_ELSE --><a id="boremail" href="mailto:<!-- TMPL_VAR NAME="boremail" -->"><!-- TMPL_VAR NAME="boremail" --></a><!-- /TMPL_IF --></li><!-- /TMPL_IF -->
                        <!-- TMPL_IF NAME="debarred" --><li class="error">Patron is RESTRICTED</li><!-- /TMPL_IF -->
                        <!-- TMPL_IF NAME="gonenoaddress" --><li class="error">Patron's address is in doubt</li><!-- /TMPL_IF -->
                    </ul>
		<!-- TMPL_IF name="transfertodo" -->
            <h4><strong>Transfer to:</strong> <!-- TMPL_VAR Name="destbranchname" --> (<!-- TMPL_VAR Name="destbranchcode" -->)</h4>
		<!-- TMPL_ELSE -->
		<h4><strong>Hold at</strong> <!-- TMPL_VAR Name="destbranchname" --></h4>
        <!-- /TMPL_IF -->

		<!-- TMPL_IF name="HoldButtonConfirm" -->
            <input type="submit" class="approve" value="Confirm" />
        	<!-- /TMPL_IF -->
		<!-- TMPL_IF name="HoldButtonPrintConfirm" -->
			<!-- TMPL_IF NAME="UseReceiptTemplates" -->
				<!-- TMPL_IF NAME="UseReceiptTemplates_HoldFound" -->
			                <input type="submit" value="Print Slip and Confirm" class="print" onclick="Dopop('/cgi-bin/koha/tools/receipt_generation.pl?action=hold_found&amp;reservenumber=<!-- TMPL_VAR NAME="reservenumber" -->&amp;borrowernumber=<!-- TMPL_VAR NAME="borrowernumber" -->&amp;biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->'); this.form.submit();" />
				<!-- /TMPL_IF -->
			<!-- TMPL_ELSE -->
				<input type="submit" value="Print Slip and Confirm" class="print" onclick="Dopop('hold-transfer-slip.pl?transfer=1&amp;borrowernumber=<!-- TMPL_VAR NAME="borrowernumber" -->&amp;biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->&amp;op=slip'); this.form.submit();" />
			<!-- /TMPL_IF -->

            <!-- TMPL_LOOP Name="inputloop" -->
                <input type="hidden" name="od-<!-- TMPL_VAR NAME="counter" -->" value="<!-- TMPL_VAR NAME="overdue" -->" />
                <input type="hidden" name="ri-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="barcode" -->" />
                <input type="hidden" name="dd-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="duedate" -->" />
                <input type="hidden" name="bn-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="borrowernumber" -->" />
            <!-- /TMPL_LOOP -->
            <input type="hidden" name="diffBranch" value="<!-- TMPL_VAR Name="destbranch" -->" />
            <input type="hidden" name="exemptfine" value="<!-- TMPL_VAR Name="exemptfine" -->" />
            <input type="hidden" name="dropboxmode" value="<!-- TMPL_VAR Name="dropboxmode" -->" />
            <input type="hidden" name="barcode" value="0" />
        	<!-- /TMPL_IF -->
        <input type=hidden name="fromqueue" value="<!-- TMPL_VAR NAME="fromqueue" -->">
        <input type=hidden name="queue_branchlimit" value="<!-- TMPL_VAR NAME="queue_branchlimit" -->">
        <input type=hidden name="queue_currpage" value="<TMPL_VAR NAME="queue_currPage">">
        <input type=hidden name="queue_limit"    value="<TMPL_VAR NAME="queue_limit">">
        <input type=hidden name="queue_orderby"  value="<TMPL_VAR NAME="queue_orderby">">
        </form>
		</div>
    <!-- /TMPL_IF -->

    <!-- TMPL_IF Name="transfer" -->
    <!-- transfer: item with no reservation, must be returned to its homebranch -->
	<div class="dialog message">
      <p class=error>No holds pending; item needs to be returned to its homebranch.</p>
	  <h3>Please return <a href="/cgi-bin/koha/catalogue/detail.pl?type=intra&amp;biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->"><!-- TMPL_VAR NAME="title" escape="html" DEFAULT="item" --></a> 
        <br>to <TMPL_VAR NAME="homebranchname"> (<TMPL_VAR NAME="homebranch">)</h3>
    <form method=post action="returns.pl" name="transferf">
        <input type=hidden name="lost_item_id" value="">
        <input type=hidden name="lostbarcode"  value="">
        <input type=hidden name="lostborrowernumber" value="">
        <input type=hidden name="unlinkFromAccount" value="0">
        <input type=hidden name="cancelTransfer" value="0">
        <input type=hidden name="dotransfer" value="1">
        <input type=hidden name="tobranch"   value="<TMPL_VAR NAME="homebranch">">
        <input type=hidden name="transferitem" value="<TMPL_VAR NAME="itemnumber">">
        <input type=hidden name="itemnumber" value="<TMPL_VAR NAME="itemnumber">">
        <input type="hidden" name="exemptfine" value="<TMPL_VAR NAME="exemptfine">"/>
        <input type="hidden" name="dropboxmode" value="<TMPL_VAR NAME="dropboxmode">"/>
        <input type="hidden" name="checkin_override_date" value="<TMPL_VAR NAME="checkin_override_date">"/>
	    <!-- TMPL_LOOP Name="inputloop" -->     
       <input type="hidden" name="od-<!-- TMPL_VAR NAME="counter" -->" value="<!-- TMPL_VAR NAME="overdue" -->" />
	    <input type="hidden" name="ri-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="barcode" -->" /> 
	    <input type="hidden" name="dd-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="duedate" -->" /> 
	    <input type="hidden" name="bn-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="borrowernumber" -->" /> 
	    <!-- /TMPL_LOOP -->                            
        <input type=submit value="Confirm transfer" class="approve">
        <input type=button value="Keep here" class="deny" onclick="
            document.transferf.dotransfer.value    =0;
            document.transferf.cancelTransfer.value=1;
            this.form.submit();"
        />
    </form>
    </div>
    <!-- /TMPL_IF -->

    <!-- deprecated: TMPL_UNLESS NAME="lostreturned" -->
    <!-- TMPL_IF Name="needstransfer" -->
	<div class="dialog message">
          <p class=error>No holds pending; item needs to be returned to its homebranch.</p>
	  <h3>Please return <a href="/cgi-bin/koha/catalogue/detail.pl?type=intra&amp;biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->"><!-- TMPL_VAR NAME="title" escape="html" DEFAULT="item" --></a> 
            <br>to <TMPL_VAR NAME="homebranchname"> (<TMPL_VAR NAME="homebranch">)</h3>
   <form method="post" action="returns.pl" name="mainform" id="mainform">              
	<input type="submit" name="dotransfer" value="Confirm transfer" class="approve" />
	<input type="submit" name="notransfer" value="Keep here" class="deny" />
	<input type="hidden" name="tobranch" value="<!-- TMPL_VAR NAME="homebranch" -->" />
	<input type="hidden" name="transferitem" value="<!-- TMPL_VAR NAME="itemnumber" -->" />
        <input type="hidden" name="itemnumber" value="<!-- TMPL_VAR NAME="itemnumber" -->" />
   <input type="hidden" name="exemptfine" value="<!-- TMPL_VAR Name="exemptfine" -->" />
   <input type="hidden" name="dropboxmode" value="<!-- TMPL_VAR Name="dropboxmode" -->" />
   <input type="hidden" name="checkin_override_date" value="<!-- TMPL_VAR Name="checkin_override_date" -->" />
   <input type=hidden name="lost_item_id" value="">
   <input type=hidden name="lostbarcode"  value="">
   <input type=hidden name="lostborrowernumber" value="">
   <input type=hidden name="unlinkFromAccount" value="0">

    	<!-- TMPL_LOOP Name="inputloop" -->     
        <input type="hidden" name="od-<!-- TMPL_VAR NAME="counter" -->" value="<!-- TMPL_VAR NAME="overdue" -->" />
	    <input type="hidden" name="ri-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="barcode" -->" /> 
    	<input type="hidden" name="dd-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="duedate" -->" /> 
	    <input type="hidden" name="bn-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="borrowernumber" -->" /> 
    	<!-- /TMPL_LOOP -->                            
	<input type="hidden" name="barcode" value="0" />    
	</form>   </div>
	<!-- /TMPL_IF -->
   <!-- /deprecated: TMPL_UNLESS -->
    	
   <!-- TMPL_IF Name="diffbranch" -->
	<!-- diffbranch -->
        <h3>Item Consigned:</h3>
        <table>
        <caption><a href="/cgi-bin/koha/catalogue/detail.pl?type=intra&amp;biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->"><!-- TMPL_VAR Name="title" escape="html" --></a></caption>
        <tr>
            <th>Hold for:</th>
            <td><!-- TMPL_VAR Name="name" --></td>
        </tr>
        </table>
        <form method="post" action="returns.pl"><input type="submit" value="OK" />
            <!-- TMPL_LOOP Name="inputloop" -->
                <!-- TMPL_UNLESS Name="first" -->
                    <input type="hidden" name="od-<!-- TMPL_VAR NAME="counter" -->" value="<!-- TMPL_VAR NAME="overdue" -->" />
                    <input type="hidden" name="ri-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="barcode" -->" />
                    <input type="hidden" name="dd-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="duedate" -->" />
                    <input type="hidden" name="bn-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="borrowernumber" -->" />
                <!-- /TMPL_UNLESS -->
            <!-- /TMPL_LOOP -->
            <input type="hidden" name="barcode" value="0" />
        </form>
    <!-- /TMPL_IF -->
    
    <!-- item is damaged -->
    <!-- TMPL_IF Name="damaged" -->
        <!-- damaged -->
        <div class="dialog message">
	  <h3>Item Damaged: <a href="/cgi-bin/koha/catalogue/detail.pl?biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->"><!-- TMPL_VAR Name="title" escape="html" --></a></h3>
          <h5> Hold will remain on item until repaired </h5>
          <input type="submit" class="deny" value="OK" onclick="$('.dialog:visible').hide('slow'); $('#barcode').focus(); return false;" />
        </div>
    <!-- /TMPL_IF -->
    
    <!-- item is damaged, but other items are available  -->
    <!-- TMPL_IF Name="damaged_othersavailable" -->
        <!-- damaged but others available -->
        <div class="dialog message">
	  <h3>Item Damaged: <a href="/cgi-bin/koha/catalogue/detail.pl?biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->"><!-- TMPL_VAR Name="title" escape="html" --></a>.</h3>
          <h5>Other items are available to fill pending holds; please retrieve one of those and check it in to trigger the hold.</h5>
          <input type="submit" class="deny" value="OK" onclick="$('.dialog:visible').hide('slow'); $('#barcode').focus(); return false;" />
        </div>
    <!-- /TMPL_IF -->

    <!-- case of simple return no issue or transfer but with a reservation  -->
    <!-- TMPL_IF Name="reserved" -->
	<!--  reserved  -->

    <!-- TMPL_IF NAME="soundon" -->
    <audio src="/intranet-tmpl/prog/sound/opening.ogg" autoplay="autoplay" autobuffer="autobuffer"></audio>
    <!-- /TMPL_IF -->

	<div class="dialog message">
    <form method="post" action="returns.pl" class="confirm" name="foundf">
    <input type=hidden name="lost_item_id" value="">
    <input type=hidden name="lostbarcode"  value="">
    <input type=hidden name="lostborrowernumber" value="">
    <input type=hidden name="unlinkFromAccount" value="0">
	  <h3>Hold Found: <a href="/cgi-bin/koha/catalogue/detail.pl?biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->"><!-- TMPL_VAR Name="title" escape="html" --></a></h3>
        <!-- TMPL_IF NAME="reservenotes" --><h4>Notes: <!-- TMPL_VAR Name="reservenotes" --></h4><!-- /TMPL_IF -->
        <h5>Hold for:</h5>
		<ul>
            <li><a href="/cgi-bin/koha/members/moremember.pl?borrowernumber=<!-- TMPL_VAR NAME="borrowernumber" -->">
                <!-- TMPL_VAR Name="borsurname" -->, <!-- TMPL_VAR Name="borfirstname" -->
            </a> (<!-- TMPL_VAR Name="borcnum" -->)</li>
            <li><!-- TMPL_VAR Name="boraddress" --><br />
			<!-- TMPL_IF NAME="boraddress2" --><!-- TMPL_VAR NAME="boraddress2" --><br /><!-- /TMPL_IF -->
			<!-- TMPL_VAR Name="borcity" --> <!-- TMPL_VAR NAME="borzip" --></li>
            <!-- TMPL_IF NAME="borphone" --><li><!-- TMPL_VAR Name="borphone" --></li><!-- /TMPL_IF -->
            <!-- TMPL_IF NAME="boremail" --><li><!-- TMPL_IF name="transfertodo" --><!-- TMPL_VAR NAME="boremail" --><!-- TMPL_ELSE --><a id="boremail" href="mailto:<!-- TMPL_VAR NAME="boremail" -->"><!-- TMPL_VAR NAME="boremail" --></a><!-- /TMPL_IF --></li><!-- /TMPL_IF -->
<!-- TMPL_IF NAME="debarred" --><li class="error">Patron is RESTRICTED</li><!-- /TMPL_IF -->
<!-- TMPL_IF NAME="gonenoaddress" --><li class="error">Patron's address is in doubt</li><!-- /TMPL_IF -->
        </ul>
        <!-- TMPL_IF name="transfertodo" -->
            <h4><strong>Transfer to:</strong> <!-- TMPL_VAR Name="destbranchname" --> (<!-- TMPL_VAR Name="destbranchcode" -->)</h4>
		<!-- TMPL_ELSE -->
		<h4><strong>Hold at</strong> <!-- TMPL_VAR Name="destbranchname" --></h4>
        <!-- /TMPL_IF -->
         <!-- TMPL_IF name="transfertodo" -->
                <input type=hidden name="dotransfer" value="1">
                <input type=hidden name="transferitem" value="<TMPL_VAR NAME="itemnumber">">
                <input type=hidden name="tobranch" value="<TMPL_VAR NAME="destbranch">">
      		<!-- TMPL_IF name="HoldButtonConfirm" -->
                <input type="submit" class="approve" value="Confirm hold and <TMPL_IF NAME="reroute">reroute </TMPL_IF>Transfer" />
        	   <!-- /TMPL_IF -->
		      <!-- TMPL_IF name="HoldButtonPrintConfirm" -->
			      <!-- TMPL_IF NAME="UseReceiptTemplates" -->
				      <!-- TMPL_IF NAME="UseReceiptTemplates_TransitHold" -->
			                <input type="submit" value="Print Slip, Transfer and Confirm" class="print" onclick="Dopop('/cgi-bin/koha/tools/receipt_generation.pl?action=transit_hold&amp;reservenumber=<!-- TMPL_VAR NAME="reservenumber" -->&amp;borrowernumber=<!-- TMPL_VAR NAME="borrowernumber" -->&amp;biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->'); this.form.submit();" />
				      <!-- /TMPL_IF -->
			      <!-- TMPL_ELSE -->
		                <input type="submit" value="Print slip, Transfer, and Confirm" class="print" onclick="Dopop('hold-transfer-slip.pl?transfer=1&amp;borrowernumber=<!-- TMPL_VAR NAME="borrowernumber" -->&amp;reservenumber=<!-- TMPL_VAR NAME="reservenumber" -->&amp;biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->&amp;op=slip'); this.form.submit();" />
			      <!-- /TMPL_IF -->
        	   <!-- /TMPL_IF -->
         <!-- TMPL_ELSE -->
		      <!-- TMPL_IF name="HoldButtonConfirm" -->
                <input type="submit" class="approve" value="Confirm hold" />
        	   <!-- /TMPL_IF -->
		      <!-- TMPL_IF name="HoldButtonPrintConfirm" -->
			      <!-- TMPL_IF NAME="UseReceiptTemplates" -->
				      <!-- TMPL_IF NAME="UseReceiptTemplates_HoldFound" -->
			                <input type="submit" value="Print Slip and Confirm" class="print" onclick="Dopop('/cgi-bin/koha/tools/receipt_generation.pl?action=hold_found&amp;reservenumber=<!-- TMPL_VAR NAME="reservenumber" -->&amp;borrowernumber=<!-- TMPL_VAR NAME="borrowernumber" -->&amp;biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->'); this.form.submit();" />
				      <!-- /TMPL_IF -->
			      <!-- TMPL_ELSE -->
		                <input type="submit" value="Print Slip and Confirm" class="print" onclick="Dopop('hold-transfer-slip.pl?borrowernumber=<!-- TMPL_VAR NAME="borrowernumber" -->&amp;biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->&amp;reservenumber=<!-- TMPL_VAR NAME="reservenumber" -->&amp;op=slip'); this.form.submit();" />
			      <!-- /TMPL_IF -->
            <!-- /TMPL_IF -->
         <!-- /TMPL_IF -->
		   <!-- TMPL_IF name="HoldButtonIgnore" -->
                <input type=hidden name="cancelTransfer" value="0">
                <input type="button" class="deny" value="Ignore<TMPL_IF NAME="WrongTransfer">, Cancel transfer, Keep here<TMPL_ELSIF NAME="transfertodo">, Keep here</TMPL_IF>" onclick=" 
                    <TMPL_IF NAME="queue_branchlimit">parent.parent.GB_hide();
                    </TMPL_IF>
                    // don't autoset reserve to Waiting, leave alone
                    document.foundf.dotransfer.value    = 0;
                    document.foundf.reservenumber.value = 0;
                    document.foundf.resbarcode.value    = '';
                    document.foundf.cancelTransfer.value= 1;
                    this.form.submit();
                " />
            	<!-- /TMPL_IF -->
            <!-- TMPL_LOOP Name="inputloop" -->
   <input type="hidden" name="od-<!-- TMPL_VAR NAME="counter" -->" value="<!-- TMPL_VAR NAME="overdue" -->" />
	<input type="hidden" name="ri-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="barcode" -->" />
	<input type="hidden" name="dd-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="duedate" -->" />
	<input type="hidden" name="bn-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="borrowernumber" -->" />
            <!-- /TMPL_LOOP -->
            <input type="hidden" name="reservenumber" value="<!-- TMPL_VAR Name="reservenumber" -->" />
            <input type="hidden" name="itemnumber" value="<!-- TMPL_VAR Name="itemnumber" -->" />
            <input type="hidden" name="borrowernumber" value="<!-- TMPL_VAR Name="borrowernumber" -->" />
            <input type="hidden" name="resbarcode" value="<!-- TMPL_VAR Name="barcode" -->" />
            <input type="hidden" name="diffBranch" value="<!-- TMPL_VAR Name="destbranch" -->" />
            <input type="hidden" name="exemptfine" value="<!-- TMPL_VAR Name="exemptfine" -->" />
            <input type="hidden" name="dropboxmode" value="<!-- TMPL_VAR Name="dropboxmode" -->" />
            <input type="hidden" name="checkin_override_date" value="<!-- TMPL_VAR Name="checkin_override_date" -->" />
            <input type=hidden name="fromqueue" value="<!-- TMPL_VAR NAME="fromqueue" -->">
            <input type=hidden name="queue_branchlimit" value="<!-- TMPL_VAR NAME="queue_branchlimit" -->">
            <input type=hidden name="queue_currPage" value="<TMPL_VAR NAME="queue_currPage">">
            <input type=hidden name="queue_limit"    value="<TMPL_VAR NAME="queue_limit">">
            <input type=hidden name="queue_orderby"  value="<TMPL_VAR NAME="queue_orderby">">
        </form>
	</div>
    <!-- /TMPL_IF -->
<TMPL_ELSIF NAME="found"><!-- do nothing more -->
<TMPL_ELSIF NAME="WasLost"><!-- do nothing more -->
<TMPL_ELSIF NAME="WrongTransfer"><!-- do nothing more -->
<TMPL_ELSIF NAME="reroute"><!-- do nothing more -->
<TMPL_ELSE>

    <div id="exemptfines" class="dialog message" style="display:none;">
        <p>Fines for returned items are forgiven.</p>
    </div>
    <div id="dropboxmode" class="dialog message" style="display:none;">
        <p>Dropbox Mode.  (Effective checkin date is <!-- TMPL_VAR NAME="dropboxdate" --> ).</p>
    </div>
</div>
	<div class="yui-g">
    <form method="post" action="/cgi-bin/koha/circ/returns.pl" name="myf" id="myf">
    <div class="yui-u first">
            <fieldset>
	<legend>Check In</legend>
            <label for="barcode">Enter item barcode: </label>
			<!-- TMPL_IF NAME="exemptfine" -->
			<input name="barcode" id="barcode" size="14" class="focus alert"/>
			<!-- TMPL_ELSIF NAME="dropboxmode" -->
			<input name="barcode" id="barcode" size="14" class="focus alert"/>
			<!-- TMPL_ELSE -->
			<input name="barcode" id="barcode" size="14" class="focus"/>
			<!-- /TMPL_IF -->
            <input id="barcode_submit" type="submit" class="submit" value="Submit"/>
            <script>
            $('barcode').keypress(function(e) {
               // if the key pressed is the enter key
               if (e.which == 13) {
                  document.myf.submit();
                  return;
               }
            });
            </script>
            <!-- TMPL_LOOP Name="inputloop" -->
                <input type="hidden" name="od-<!-- TMPL_VAR NAME="counter" -->" value="<!-- TMPL_VAR NAME="overdue" -->" />
                <input type="hidden" name="ri-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="barcode" -->" />
                <input type="hidden" name="dd-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="duedate" -->" />
                <input type="hidden" name="bn-<!-- TMPL_VAR Name="counter" -->" value="<!-- TMPL_VAR Name="borrowernumber" -->" />
            <!-- /TMPL_LOOP -->
			
   
            </fieldset>
            </div>
            <div class="yui-u">
            <fieldset id="checkin_options">
                <legend>Options</legend>

                <ul>
                    <!-- TMPL_IF NAME="overduecharges" -->
                    <!-- TMPL_IF NAME="CAN_user_circulate_exempt_fines" -->
                    <li>
                        <!-- TMPL_IF NAME="exemptfine" -->
                        <input type="checkbox" id="exemptcheck" name="exemptfine" value="exemptfine" checked="checked" />
                        <!-- TMPL_ELSE -->
                        <input type="checkbox" id="exemptcheck" name="exemptfine" value="exemptfine" />
                        <!-- /TMPL_IF -->
                        <label for="exemptcheck">Forgive overdue charges</label>
                    </li>
                    <!-- /TMPL_IF -->
                    <!-- /TMPL_IF --> <!-- overduecharges -->
                    <!-- TMPL_IF NAME="CAN_user_circulate_bookdrop" -->
                    <li>
                        <!-- TMPL_IF NAME="dropboxmode" -->
                        <input type="checkbox" id="dropboxcheck" name="dropboxmode" value="dropboxmode" checked="checked" />
                        <!-- TMPL_ELSE -->
                        <input type="checkbox" id="dropboxcheck" name="dropboxmode" value="dropboxmode" />
                        <!-- /TMPL_IF -->
                        <label for="dropboxcheck">Dropbox mode</label>
                    </li>
                    <!-- /TMPL_IF -->
                    <!-- TMPL_IF NAME="AllowCheckInDateChange" -->
                    <!-- TMPL_IF NAME="CAN_user_circulate_change_circ_date_and_time" -->
                    <li>
                    <!-- TMPL_IF NAME="checkin_override_date" -->
                        <input type="text" size="10" id="f_checkin_override_date" name="checkin_override_date" value="<!-- TMPL_VAR NAME="checkin_override_date" -->" readonly="1" />
                    <!-- TMPL_ELSE -->
                        <input type="text" size="10" id="f_checkin_override_date" name="checkin_override_date" value="" readonly="1"/>
                    <!-- /TMPL_IF -->
                         <img src="<!-- TMPL_VAR NAME="themelang" -->/lib/calendar/cal.gif" id="f_trigger_c" style="cursor: pointer;"
                         title="CheckIn Date selector" />
                        <script type="text/javascript">
                            Calendar.setup({
                                inputField      :   "f_checkin_override_date",
                                 ifFormat       : "<!-- TMPL_VAR NAME="DHTMLcalendar_dateformat" -->",
                                 button         : "f_trigger_c",
                                 singleClick    : true
                             });
                        </script>
                        <label for="checkin_override_date">Override Check In Date 
                        <script>
                        var odate = document.myf.f_checkin_override_date.value;
                        if (odate != '') {
                           document.write('<input type=button value="Clear Date" onclick="clearBackdate()">');
                        }
                        </script>
                        </label>
                    </li>
                    <!-- /TMPL_IF -->
                </ul>
            </fieldset>
        </div>
    </form>
</div>

<!-- TMPL_IF Name="returned" -->
<div class="yui-g">    <table>
        <tr><th>Item Information</th><th>Patron Information</th></tr>
        <tr>
            <td><!-- TMPL_VAR Name="title" escape="html" --></td>
            <td>
                
                <a href="/cgi-bin/koha/members/moremember.pl?borrowernumber=<!-- TMPL_VAR Name="riborrowernumber" -->"><!-- TMPL_VAR Name="riborsurname" -->, <!-- TMPL_VAR Name="ribortitle" --> <!-- TMPL_VAR Name="riborfirstname" --></a> (<!-- TMPL_VAR Name="riborcnum" -->)
                <!-- TMPL_IF Name="flagset" -->
                (<!-- TMPL_LOOP Name="flagloop" -->
                <!-- TMPL_VAR Name="flag" -->
		<!-- TMPL_IF NAME="charges" --> of <!-- TMPL_VAR NAME="chargeamount" --> <!-- /TMPL_IF -->
		,
                <!-- /TMPL_LOOP -->)<!-- /TMPL_IF -->
            </td>
        </tr>
    </table>
<!-- /TMPL_IF -->
<!-- TMPL_IF Name="riloop" -->
    <h2>Checked-In items 
	<!-- TMPL_IF NAME="UseReceiptTemplates_CheckIn" -->
		<button onclick='window.open("/cgi-bin/koha/tools/receipt_generation.pl?action=check_in<!-- TMPL_LOOP NAME="riloop" -->&amp;barcode=<!-- TMPL_VAR NAME="barcode" --><!-- /TMPL_LOOP -->", "printwindow");'>Print Receipt</button> 
	<!-- /TMPL_IF -->
    </h2>
    <table>
	<tr><th>Due Date</th><th>Title</th>	<th>Author</th>	<th>Barcode</th><th>Type</th>	<th>Patron</th><th>Note</th></tr>
        
        <!-- TMPL_LOOP Name="riloop" -->
            <tr>
            <td><!-- TMPL_IF Name="duedate" -->
                    <TMPL_IF NAME="overdue">
                        <span class="overdue"><!-- TMPL_VAR NAME="duedate" --> (overdue)</span>
                    <!-- TMPL_ELSE --><!-- TMPL_VAR NAME="duedate" -->
                    <!-- /TMPL_IF -->
                <!-- TMPL_ELSE -->Not checked out
                <!-- /TMPL_IF -->
            </td>
            <td><a href="/cgi-bin/koha/catalogue/detail.pl?biblionumber=<!-- TMPL_VAR Name="itembiblionumber" -->">
                    <!-- TMPL_VAR Name="itemtitle" escape="html" --></a></td>
			<td><!-- TMPL_VAR Name="itemauthor" --></td>
            <td><a href="/cgi-bin/koha/catalogue/moredetail.pl?biblionumber=<!-- TMPL_VAR NAME="itembiblionumber" -->&amp;itemnumber=<!-- TMPL_VAR NAME="itemnumber" -->#item<!-- TMPL_VAR NAME="itemnumber" -->"><!-- TMPL_VAR Name="barcode" --></a></td>
            <td><!-- TMPL_VAR Name="itemtype" --> <!-- TMPL_VAR Name="ccode" --></td>
			<td><!-- TMPL_IF Name="duedate" -->
            <!-- TMPL_IF NAME="CAN_user_circulate_view_borrower_name_in_checkin" -->
                <a href="/cgi-bin/koha/members/moremember.pl?borrowernumber=<!-- TMPL_VAR Name="borrowernumber" -->">
                    <!-- TMPL_VAR Name="borsurname" -->, <!-- TMPL_VAR Name="borfirstname" --> (<!-- TMPL_VAR name="borcategorycode" -->)
                </a>
            <!-- TMPL_ELSE --> <!-- not allowed to see name so no link either -->
            <!-- TMPL_VAR NAME="borcnum" -->
            <!-- /TMPL_IF -->
            <!-- TMPL_ELSE -->Not checked out<!-- /TMPL_IF --></td>
            <td><!-- TMPL_IF name="bornote" --><span class="circ-hlt"><!-- TMPL_VAR name="bornote" --><br /></span><!-- /TMPL_IF -->
            <!-- TMPL_IF name="itemnote" --><span class="circ-hlt"><!-- TMPL_VAR name="itemnote" --></span><!-- /TMPL_IF -->
            <!-- TMPL_IF NAME="havecheckinnotes" -->
            <script type="text/javascript">
            var url = 'returns.pl?biblionumber='
            +'<!-- TMPL_VAR NAME="itembiblionumber" -->&itemnumber='
            +'<!-- TMPL_VAR NAME="itemnumber" -->&checkinnote=1';
            window.open(url,'Check In Note','width=300,height=300,scrollbars=1');
            </script>
            <!-- /TMPL_IF -->
            </td>
           </tr>
        <!-- /TMPL_LOOP -->
    </table></div>
<!-- /TMPL_IF -->


</div>
<!-- TMPL_INCLUDE NAME="intranet-bottom.inc" -->
